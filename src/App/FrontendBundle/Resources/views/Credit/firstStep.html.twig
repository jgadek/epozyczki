{% extends "::base.html.twig" %}
{% block body %}
<div class="section">
    <div class="container">
        <div class="header">Kreator pożyczki</div>
        <div class="header-description">Wypełnij formularz - <span>to zajmie tylko 5 minut</span></div>
        <div class="section-content">
            <div class="section-content-steps" id="get-loan-steps">
                <div class="section-content-steps-column active">
                    <div class="section-content-steps-column-content" onClick="location.href = '{{ url('app_frontend_credit_firstStep') }}'">
                        <div class="section-content-steps-column-content-circle-background"><div class="section-content-steps-column-content-circle-number">1</div></div>
                        <div class="section-content-steps-column-content-text">Określ potrzeby</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="section-content-steps-column" onClick="location.href = '{{ url('app_frontend_credit_secondStep') }}'">
                    <div class="section-content-steps-column-content">
                        <div class="section-content-steps-column-content-circle-background"><div class="section-content-steps-column-content-circle-number">2</div></div>
                        <div class="section-content-steps-column-content-text">Podaj szczegóły</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="section-content-steps-column" onClick="location.href = '{{ url('app_frontend_credit_thirdStep') }}'">
                    <div class="section-content-steps-column-content">
                        <div class="section-content-steps-column-content-circle-background"><div class="section-content-steps-column-content-circle-number">3</div></div>
                        <div class="section-content-steps-column-content-text">Twoje dane</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="section-content-steps-column" onClick="location.href = '{{ url('app_frontend_credit_fourthStep') }}'">
                    <div class="section-content-steps-column-content">
                        <div class="section-content-steps-column-content-circle-background"><div class="section-content-steps-column-content-circle-number">4</div></div>
                        <div class="section-content-steps-column-content-text">Wyślij wniosek</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
            <div class="clear"></div>
            <div class="section-content-wrapper" id="get-loan-creator">
                {{ form_start(form) }}
                {{ form_widget(form) }}
                <div class="section-content-wrapper-equalBox">
                    <div class="section-content-wrapper-top">
                        <div class="section-content-wrapper-top-header with-margin">Kwota pożyczki:</div>
                        <div class="section-content-wrapper-top-inputBox">
                            <div class="section-content-wrapper-top-inputBox-input"><input type="text" value="100000" id="amountInput"></div>
                            <div class="section-content-wrapper-top-inputBox-label">PLN</div>
                            <div class="clear"></div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="sliderContainer">
                        <div id="amountSlider"></div>
                    </div>
                    <div class="section-content-wrapper-slider-labels">
                        <div class="section-content-wrapper-slider-labels-min">10 000 PLN</div>
                        <div class="section-content-wrapper-slider-labels-max">1 000 000 PLN</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="section-content-wrapper-equalBox">
                    <div class="section-content-wrapper-top">
                        <div class="section-content-wrapper-top-header with-margin">Okres spłaty:</div>
                        <div class="section-content-wrapper-top-inputBox">
                            <div class="section-content-wrapper-top-inputBox-input"><input type="text" value="12" id="periodInput"></div>
                            <div class="section-content-wrapper-top-inputBox-label">mc</div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    <div class="sliderContainer">
                        <div id="periodSlider"></div>
                    </div>
                    <div class="section-content-wrapper-slider-labels">
                        <div class="section-content-wrapper-slider-labels-min">1 mc</div>
                        <div class="section-content-wrapper-slider-labels-max">36 mc</div>
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="clear"></div>
                <div class="section-content-wrapper-biggerBox">
                    <div class="creator-content-biggerBox-content">
                        <div class="section-content-wrapper-top">
                            <div class="section-content-wrapper-top-header">Symulacja pożyczki:</div>
                            <div class="clear"></div>
                        </div>
                        <div class="clear"></div>
                        <div class="fullBox">
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Kapitał do spłaty:</div>
                                <div class="section-content-wrapper-row-description" id="simulationStartAmount">50 000 PLN</div>
                            </div>
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Kapitał odsetek:</div>
                                <div class="section-content-wrapper-row-description" id="simulationInterest">8 000 PLN</div>
                            </div>
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Okres spłaty:</div>
                                <div class="section-content-wrapper-row-description" id="simulationPeriod">12 mc</div>
                            </div>
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Prowizja 1%:</div>
                                <div class="section-content-wrapper-row-description" id="simulationCommission">500 PLN</div>
                            </div>
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Maksymalna % odsetek:</div>
                                <div class="section-content-wrapper-row-description">12% rocznie</div>
                            </div>
                            <div class="section-content-wrapper-row">
                                <div class="section-content-wrapper-row-label">Koszty administracyjne:</div>
                                <div class="section-content-wrapper-row-description">1 000 PLN</div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                </div>
                <div class="section-content-wrapper-smallerBox rightAlign">
                    <div class="section-content-wrapper-top without-bottomMargin">
                        <div class="section-content-wrapper-top-header rightAlign">Całkowity koszt pożyczki:</div>
                        <div class="clear"></div>
                    </div>
                    <div class="section-content-wrapper-smallerBox-price" id="simulationEndAmount">59 500 PLN</div>
                    <div class="section-content-wrapper-smallerBox-button"><input type="submit" class="darkButton" value="Dalej"></div>
                    <div class="clear"></div>
                </div>
                <div class="clear"></div>
            {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<div id="push"></div>
{% endblock %}
{% block javascripts %}
<script>
    $(document).ready(function() {
        $("#amountSlider").slider({
            range: "min",
            value: 100000,
            min: 10000,
            max: 1000000,
            animate: true,
            step: 1000,
            slide: function(event, ui) {
                $("#amountInput").val(ui.value);
                updateSimulation();
            }
        });

        $("#periodSlider").slider({
            range: "min",
            value: 12,
            min: 1,
            max: 36,
            animate: true,
            step: 1,
            slide: function(event, ui) {
                $("#periodInput").val(ui.value);
                updateSimulation();
            }
        });

        $("#amountInput").change(function() {
            if ($(this).val() < 10000) {
                $(this).val("10000");
            }
            else if ($(this).val() > 1000000) {
                $(this).val("1000000");
            }
            $("#amountSlider").slider("value", $(this).val());

            updateSimulation();
        });

        $("#periodInput").change(function() {
            if ($(this).val() < 1) {
                $(this).val("1");
            }
            else if ($(this).val() > 36) {
                $(this).val("36");
            }
            $("#periodSlider").slider("value", $(this).val());

            updateSimulation();
        });

        function updateSimulation() {
            var amount = parseInt($("#amountInput").val());
            var period = parseInt($("#periodInput").val());

            var interest = amount * (0.12 * (period / 12));
            interest = Math.round(interest * 100) / 100;
            var commission = 0.01 * amount;
            commission = Math.round(commission * 100) / 100;

            var sum = amount + interest + commission + 1000;

            $("#simulationStartAmount").text(amount + " PLN");
            $("#simulationPeriod").text(period + " mc");
            $("#simulationInterest").text(interest + " PLN");
            $("#simulationCommission").text(commission + " PLN");
            $("#simulationEndAmount").text(sum + " PLN");
        }

        $formName = '{{ form.vars.name }}';

        if ($('#' + $formName + '_intCreditAmount').val() != '') {
            $("#amountInput").val($('#' + $formName + '_intCreditAmount').val());
            $("#amountSlider").slider("value", $('#' + $formName + '_intCreditAmount').val());
        }

        if ($('#' + $formName + '_intRepaymentTime').val() != '') {
            $("#periodInput").val($('#' + $formName + '_intRepaymentTime').val());
            $("#periodSlider").slider("value", $('#' + $formName + '_intRepaymentTime').val());
        }
        updateSimulation();


        $('form[name="' + $formName + '"]').submit(function() {
            var amount = parseInt($("#amountInput").val());
            var period = parseInt($("#periodInput").val());
            $('#' + $formName + '_intCreditAmount').val(amount);
            $('#' + $formName + '_intRepaymentTime').val(period);
        });
    });
</script>
{% endblock %}

